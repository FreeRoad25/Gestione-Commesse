{% extends "layout.html" %}
{% block title %}Archivio Commesse Consegnate{% endblock %}

{% block content %}
<div class="archivio-wrapper">
    <h1>ðŸ—ƒ Archivio Commesse Consegnate</h1>

    <div class="top-bar">
        <a href="{{ url_for('lista_commesse') }}" class="btn btn-back">â¬… Torna alle Commesse Attive</a>
    </div>

    <div class="tabella-archivio">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Tipo Intervento</th>
                    <th>Marca</th>
                    <th>Modello</th>
                    <th>Data Conferma</th>
                    <th>Data Consegna</th>
                    <th>Ore Prev.</th>
                    <th>Ore Eseg.</th>
                    <th>Ore Rim.</th>
                    <th>Saldata</th>
                    <th>Azioni</th>
                </tr>
            </thead>
            <tbody>
                {% for com in commesse %}
                <tr class="{% if com.saldata in ['No','NO','no'] %}non-saldata{% endif %}">
                    <td>{{ com.id }}</td>
                    <td>{{ com.nome }}</td>
                    <td>{{ com.tipo_intervento }}</td>
                    <td>{{ com.marca_veicolo }}</td>
                    <td>{{ com.modello_veicolo }}</td>
                    <td>{{ com.data_conferma or '-' }}</td>
                    <td>{{ com.data_consegna or '-' }}</td>
                    <td>{{ com.ore_necessarie or '-' }}</td>
                    <td>{{ com.ore_eseguite or '-' }}</td>
                    <td>
                        {% if com.ore_necessarie and com.ore_eseguite %}
                            {{ com.ore_necessarie - com.ore_eseguite }}
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    <td>
                        <form method="POST" action="{{ url_for('aggiorna_saldato', id=com.id) }}">
                            <select name="saldata" onchange="this.form.submit()">
                                <option value="No" {% if com.saldata in ['No','NO','no'] %}selected{% endif %}>No</option>
                                <option value="Si" {% if com.saldata in ['Si','SI','si'] %}selected{% endif %}>Si</option>
                            </select>
                        </form>
                    </td>

                    <!-- ðŸ”§ QUI HO INSERITO LA STAMPA -->
                    <td>
                        <div style="display: flex; gap: 6px; justify-content: center;">
                            <!-- Pulsante stampa -->
                            <a href="{{ url_for('stampa_commessa_archiviata', id=com.id) }}" 
                               class="btn" 
                               title="Stampa Commessa"
                               style="background-color:#00b894;">ðŸ–¨</a>

                            <!-- Pulsante elimina -->
                            <form method="POST" action="{{ url_for('elimina_commessa', id=com.id) }}" 
                                  onsubmit="return confirm('Eliminare questa commessa?')">
                                <button type="submit" class="btn btn-delete">ðŸ—‘</button>
                            </form>
                        </div>
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
.archivio-wrapper * {
    all: unset;
    display: revert;
}

.archivio-wrapper table {
    width: 100%;
    border-collapse: collapse;
    background-color: #2f3241;
    border-radius: 10px;
    font-family: 'Segoe UI', Arial, sans-serif;
    font-size: 13px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.4);
}

.archivio-wrapper th, .archivio-wrapper td {
    border: 1px solid #444;
    padding: 6px 5px;
    text-align: center;
    color: #e0e0e0;
}

.archivio-wrapper th {
    background-color: #00a6c7;
    color: #fff;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 12px;
}

.archivio-wrapper tr:nth-child(even) {
    background-color: #34374a;
}

.non-saldata td {
    background-color: rgba(255,0,0,0.25) !important;
    color: #fff;
    font-weight: bold;
}

.archivio-wrapper h1 {
    text-align: center;
    color: #00b4ff;
    margin-bottom: 20px;
    font-weight: 600;
}

.archivio-wrapper .top-bar {
    text-align: right;
    margin-bottom: 10px;
}

.archivio-wrapper .btn {
    padding: 6px 10px;
    border-radius: 6px;
    background-color: #6c757d;
    color: #fff;
    cursor: pointer;
    text-decoration: none;
    font-size: 12px;
}

.archivio-wrapper .btn-delete {
    background-color: #dc3545;
}

.archivio-wrapper select {
    background-color: #1e1f29;
    color: #fff;
    border: 1px solid #555;
    border-radius: 5px;
    padding: 3px 5px;
    font-size: 11px;
}
</style>

{% endblock %}
